<!DOCTYPE html>
<html>

<head>
    <title>OpenLayers Map</title>
    <link rel="stylesheet" href="ol/ol.css" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="ol/dist/ol.js"></script>
    <link rel="stylesheet" href="style.css">


</head>

<body>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <div class="wrapper"><!--search bar-->

        <div class="searchBar">
            <input id="searchQueryInput" type="text" name="searchQueryInput" placeholder="Buscar un edificio o salÃ³n..."
                value="" />
            <button id="searchQuerySubmit" type="submit" name="searchQuerySubmit">
                <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                    <path fill="#666666"
                        d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                </svg>
            </button>
        </div>
    </div>
    <div class="searchResult" id="resultBox">
        <ul class="searchListBox" id="resultListinMap">
            <!-- results here -->
        </ul>
    </div>
    <div id="map">

    </div>
    <script>
        var bounds = ol.proj.transformExtent(
            [-104.35944, 19.772676, -104.357180, 19.77638],  // [minx, miny, maxx, maxy] EPSG:4326 
            'EPSG:4326',           // source  PROJECTIONS
            'EPSG:3857'            // destination
        );
        var map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([-104.35848, 19.77473]),
                zoom: 18.31,
                extent: bounds
            })
        });

        //VALUES
        var roomTriggerZoom = 19;
        var vectorSource = new ol.source.Vector();
        var vectorLayer = new ol.layer.Vector({
            source: vectorSource
        });
        var roomVectorSource = null;
        var roomLayer = null;
        var rooms = [];
        var edificios = [];
        var arrowControlSource = new ol.source.Vector();
        var arrowLayer = new ol.layer.Vector({
            source: arrowControlSource
        });
        map.addLayer(vectorLayer);
        var currentHiddenFeature = null;
        var edificioVerticeLayer = null;

        var currentClickedFeature = [];


        //SHAPES GO HERE

        var selectedFloor = 1 //SELECTED FLOOR VALUE

        function addEdificio(lon, lat, nombre, image, id, pisos, v1, v2, v3, v4, tipo) {
            var salones = JSON.parse(Android.getEdificioSalones(id));
            var edificio = new ol.Feature({
                geometry: new ol.geom.Point(ol.proj.fromLonLat([lat, lon])),
                nombre: nombre,
                pisos: pisos,
                id: id,
                v1: v1,
                v2: v2,
                v3: v3,
                v4: v4,
                tipo: tipo,
                image: image,
                salones: salones
            });

            edificios.push(edificio);

            var edificioStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 1],
                    src: 'data:image/png;base64,' + image,
                    scale: 1
                })
            });

            edificio.setStyle(edificioStyle);
            vectorSource.addFeature(edificio);
            console.log("Added edificio:", edificio);
            console.log("edificios", edificios);
            console.log("salones: ", salones);

            addRoomsInPolygon(edificio, salones, selectedFloor);
            drawBuildingStoryControl(edificio);
        }

        function addEdificiosFromAndroid() {
            var edificios = JSON.parse(Android.getEdificios());
            edificios.forEach(function (edificio) {
                addEdificio(edificio.lon, edificio.lat, edificio.nombre, edificio.image, edificio.id, edificio.pisos, edificio.v1, edificio.v2, edificio.v3, edificio.v4, edificio.tipo);
            });
        }

        document.addEventListener('DOMContentLoaded', (event) => { //waits for map content then loads data
            addEdificiosFromAndroid();

        });

        document.addEventListener("DOMContentLoaded", function () { //Listens for typing in search bar
            const searchBar = document.getElementById("searchQueryInput");
            const resultBox = document.getElementById("resultBox");
            searchBar.addEventListener("input", function (event) {
                const searchTerm = event.target.value;
                console.log("User typed: " + searchTerm);
                resultBox.style.display = 'block';
                handleSearch(searchTerm);
            });
        });

        function handleSearch(searchTerm) {
            const searchBar = document.getElementById("searchBar");
            const resultBox = document.getElementById("resultBox");
            const resultList = document.getElementById("resultListinMap");
            resultBox.style.display = 'block';
            var results = JSON.parse(Android.getSalonSearch(searchTerm));
            console.log("Search results: ", results);
            // document.getElementById("result-text").textContent = results[0].nombre
            resultList.innerHTML = '';
            results.forEach(function (result) {
                var item = document.createElement("li");
                item.className = 'result-li-item';
                item.textContent = result.nombre;
                resultList.appendChild(item);

                item.addEventListener("click", function (event) { //attaches a click event for every item
                    console.log("click! ", result.nombre);
                    resultBox.style.display = 'none';
                    travelToSalon(result);

                });
            });
        };

        function travelToSalon(salon) {
            var view = map.getView();
            var highlighted = false;

            rooms.forEach(function (room) {
                if (!highlighted && room.get('salonid') == salon.salonid) {
                    zoomToRoom(room, 20, 1500);
                    highlightSalon(room);



                    highlighted = true;
                } else {
                    if (salon.piso != selectedFloor) {//if clicked room does not belong in the current displayed floor

                        for (var i = rooms.length - 1; i >= 0; i--) {
                            if (rooms[i].get('piso') == selectedFloor && rooms[i].get('edificioid') == salon.edificio_edificioid) {
                                console.log("removed room: ", rooms[i].get('nombre'));
                                rooms.splice(i, 1); // Removing index i

                            }
                        }
                        map.removeLayer(roomLayer);

                        selectedFloor = salon.piso; //set selected floor to the current searched room
                        console.log("selected floor: ", selectedFloor);
                        var edificioSearched = getEdificioFeaturefromID(salon.salonid);
                        console.log("edificio object:", edificioSearched);
                        console.log("edificio searched name:", edificioSearched.get('nombre'))
                        addRoomsInPolygon(edificioSearched, edificioSearched.get('salones'), selectedFloor);//TODO: make function that returns the edificio object for the salon that it belongs to

                        if (!highlighted) {
                            travelToSalon(salon);
                            highlighted = true; // Set flag to true to avoid recursion
                        }

                    }

                }
            });
        }

        function highlightSalon(room) {
            var currentHiddenRoomStyle = room.getStyle();
            console.log("original style: ", JSON.stringify(currentHiddenRoomStyle, null, 2));

            var roomHighlight = new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'blue',
                    width: 1
                }),
                fill: new ol.style.Fill({
                    color: 'rgba(0, 0, 255, 0.1)'
                }),
                text: new ol.style.Text({
                    text: room.get('nombre'),
                    font: '16px Calibri,sans-serif',
                    fill: new ol.style.Fill({
                        color: '#000'
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#fff',
                        width: 2
                    })
                })
            });

            room.setStyle(roomHighlight);
            currentClickedFeature = [];
            currentClickedFeature.push(room);

            showPopup(room, "salon");

            var onMapClick = function (event) {
                var feature = map.forEachFeatureAtPixel(event.pixel, function (feature) {
                    return feature;
                }, {
                    hitTolerance: 10
                });

                // If no feature is clicked, revert the room style
                if (!feature) {
                    room.setStyle(currentHiddenRoomStyle);
                    console.log("Reverting to original style", JSON.stringify(currentHiddenRoomStyle, null, 2));
                    currentClickedFeature = [];
                    // Remove this click listener after it's executed
                    map.un('click', onMapClick);
                }
                else if (feature && currentClickedFeature != null) {
                    if (currentClickedFeature.length > 0) {
                        currentClickedFeature[0].setStyle(currentHiddenRoomStyle);
                    }

                    map.un('click', onMapClick);
                }
            };

            // Ensure the click event listener is only added once
            map.on('click', onMapClick);
        }

        function showFeature(feature) {
            var edificioStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 1],
                    src: 'data:image/png;base64,' + feature.get('image'),
                    scale: 1
                })
            });
            feature.setStyle(edificioStyle);
        }

        function hideFeature(feature) {
            feature.setStyle(new ol.style.Style({
                display: 'none'
            }));
        }

        function addRoomsInPolygon(edificio, salones, selectedFloor) {
            var v11 = ol.proj.fromLonLat(edificio.get('v1').split(',').map(Number));
            var v22 = ol.proj.fromLonLat(edificio.get('v2').split(',').map(Number));
            var v33 = ol.proj.fromLonLat(edificio.get('v3').split(',').map(Number));
            var v44 = ol.proj.fromLonLat(edificio.get('v4').split(',').map(Number));

            var minX = Math.min(v11[0], v22[0], v33[0], v44[0]);
            var minY = Math.min(v11[1], v22[1], v33[1], v44[1]);
            var maxX = Math.max(v11[0], v22[0], v33[0], v44[0]);
            var maxY = Math.max(v11[1], v22[1], v33[1], v44[1]);

            var viewableRooms = []
            for (var i = 0; i < Object.keys(salones).length; i++) {
                if (salones[i].piso == selectedFloor) {
                    viewableRooms.push(salones[i])
                }
            }
            var width = maxX - minX;
            var roomWidth = width / Object.keys(viewableRooms).length;


            for (var i = 0; i < Object.keys(viewableRooms).length; i++) {
                var roomMinX = minX - i * roomWidth + width;
                var roomMaxX = roomMinX - roomWidth;

                var roomCoords = [
                    [roomMinX, minY],
                    [roomMaxX, minY],
                    [roomMaxX, maxY],
                    [roomMinX, maxY],
                    [roomMinX, minY]
                ];

                var roomPolygon = new ol.geom.Polygon([roomCoords]);
                var roomFeature = new ol.Feature({
                    geometry: roomPolygon,
                    edificio: edificio,
                    salonid: viewableRooms[i].salonid,
                    nombre: viewableRooms[i].nombre,
                    descripcion: viewableRooms[i].descripcion,
                    tipo: viewableRooms[i].tipo,
                    piso: viewableRooms[i].piso,
                    edificioid: viewableRooms[i].edificio_edificioid
                });

                setFeatureStyle(roomFeature);
                rooms.push(roomFeature);
            }

            console.log("pushed viewable", viewableRooms)
            roomVectorSource = new ol.source.Vector({
                features: rooms
            });
            roomLayer = new ol.layer.Vector({
                source: roomVectorSource
            });

            map.addLayer(roomLayer);
            roomLayer.setVisible(0);



            map.getView().on('change:resolution', function () {
                var zoom = map.getView().getZoom();
                // console.log("current zoom: " + zoom)
                roomLayer.setVisible(zoom >= roomTriggerZoom);
                if (zoom < roomTriggerZoom) {
                    vectorLayer.setVisible(1);
                    arrowLayer.setVisible(0);
                } else {
                    vectorLayer.setVisible(0);
                    arrowLayer.setVisible(1);
                }

            });

        }

        function splitTextIntoLines(text, maxLength) {
            let lines = [];
            for (let i = 0; i < text.length; i += maxLength) {
                lines.push(text.substring(i, i + maxLength));

            }
            return lines;
        }

        function createDynamicTextStyle(text) {
            const maxLineLength = 7; // Maximum number of characters per line
            const maxLines = 3; // Maximum number of lines before truncation
            const baseFontSize = 16; // Base font size

            // Split text into lines
            let lines = splitTextIntoLines(text, maxLineLength);

            // Truncate lines if exceeding maximum number of lines
            if (lines.length > maxLines) {
                lines = lines.slice(0, maxLines - 1);
                lines.push('...'); // Add ellipsis if truncated
            }

            // Create a multiline text string with line breaks
            const multilineText = lines.join('\n');

            return new ol.style.Text({
                text: multilineText,
                font: baseFontSize + 'px Calibri,sans-serif',
                fill: new ol.style.Fill({
                    color: '#000'
                }),
                stroke: new ol.style.Stroke({
                    color: '#fff',
                    width: 2
                }),
                textBaseline: 'middle', // Align text vertically
                offsetY: baseFontSize / 4.2 // Adjust vertical alignment
            });
        }

        function getRoomStyle(feature) {
            return new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'green',
                    width: 1
                }),
                fill: new ol.style.Fill({
                    color: 'rgba(0, 255, 0, 0.1)'
                }),
                text: createDynamicTextStyle(feature.get('nombre'))
            });
        }

        function getOfficeStyle(feature) {
            return new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'magenta',
                    width: 1
                }),
                fill: new ol.style.Fill({
                    color: 'rgba(255, 0, 255, 0.1)'
                }),
                text: createDynamicTextStyle(feature.get('nombre'))
            });
        }

        function setFeatureStyle(feature) {
            if (feature.get('tipo') === 'salon') {
                feature.setStyle(getRoomStyle(feature));
            } else if (feature.get('tipo') === 'oficina') {
                feature.setStyle(getOfficeStyle(feature));
            }
        }

        function drawBuildingStoryControl(edificio) {
            var v1 = ol.proj.fromLonLat(edificio.get('v1').split(',').map(Number));
            var v2 = ol.proj.fromLonLat(edificio.get('v2').split(',').map(Number));
            var v3 = ol.proj.fromLonLat(edificio.get('v3').split(',').map(Number));
            var v4 = ol.proj.fromLonLat(edificio.get('v4').split(',').map(Number));

            var topY = Math.max(v1[1], v2[1], v3[1], v4[1]);
            var bottomY = Math.min(v1[1], v2[1], v3[1], v4[1]);
            var midX = (v1[0] + v2[0] + v3[0] + v4[0]) / 4;

            var arrowUpPosition = [midX, topY + 0.0001];
            var arrowDownPosition = [midX, bottomY - 0.0001];

            var upArrowFeature = new ol.Feature({
                geometry: new ol.geom.Point(arrowUpPosition),
                tipo: "uparrow",
                edificio: edificio,

            })

            var downArrowFeature = new ol.Feature({
                geometry: new ol.geom.Point(arrowDownPosition),
                tipo: "downarrow",
                edificio: edificio,

            });

            var upArrowStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 1],
                    src: 'images/up_arrow.png',
                    scale: 0.8
                })
            });

            var downArrowStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 0],
                    src: 'images/down_arrow.png',
                    scale: 0.8
                })
            });

            upArrowFeature.setStyle(upArrowStyle);
            downArrowFeature.setStyle(downArrowStyle);
            if (edificio.get('pisos') > 1) { //si el edificio tiene mas de 1 piso, agrega las flechas
                // si solo tiene un piso no son necesarias las flechas
                arrowControlSource.addFeature(upArrowFeature);
                arrowControlSource.addFeature(downArrowFeature);
            }

            map.addLayer(arrowLayer);
            arrowLayer.setVisible(0);
        }

        function showBuildingBorders(edificio) {
            //VERTICE COORDINATES
            var vcoor = [
                ol.proj.fromLonLat(edificio.v1),
                ol.proj.fromLonLat(edificio.v2),
                ol.proj.fromLonLat(edificio.v3),
                ol.proj.fromLonLat(edificio.v4)
            ]
            console.log('Vertex coordinates:', vcoor);
            var polygon = new ol.geom.Polygon([vcoor]);
            var polygonFeature = new ol.Feature(polygon, {
                tipo: edificio.tipo
            });

            var polygonStyle = new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'blue',
                    width: 2
                }),
                fill: new ol.style.Fill({
                    color: 'rgba(0, 0, 255, 0.1)'
                })
            });
            polygonFeature.setStyle(polygonStyle);

            var vectorSource = new ol.source.Vector({
                features: [polygonFeature]
            });
            edificioVerticeLayer = new ol.layer.Vector({
                source: vectorSource
            });

            // Add the vector layer to the map
            map.addLayer(edificioVerticeLayer);

        }

        function featureDetailsToString(feature) {
            var details = "feature not clicked"
            if (feature) {
                var properties = feature.getProperties();
                details = `Feature Details:\n`;

                for (var key in properties) {
                    if (properties.hasOwnProperty(key)) {
                        details += `${key}: ${properties[key]}\n`;
                    }
                }
            }


            return details;
        }

        map.on('click', function (event) {
            var feature = map.forEachFeatureAtPixel(event.pixel, function (feature) {
                return feature;
            }, {
                hitTolerance: 10
            });

            console.log(featureDetailsToString(feature))
            if (feature && currentHiddenFeature != null) {
                showFeature(currentHiddenFeature);
                map.removeLayer(edificioVerticeLayer);
            }

            if (feature && feature.get('id')) {

                var edificio = {
                    id: feature.get('id'),
                    nombre: feature.get('nombre'),
                    pisos: feature.get('pisos'),
                    v1: feature.get('v1').split(',').map(Number),
                    v2: feature.get('v2').split(',').map(Number),
                    v3: feature.get('v3').split(',').map(Number),
                    v4: feature.get('v4').split(',').map(Number),
                    tipo: feature.get('tipo'),
                    geometry: feature.getGeometry()
                };
                hideFeature(feature);

                currentHiddenFeature = feature;
                var info = feature.get('id');
                alert(info);
                showPopup(feature);
                showBuildingBorders(edificio);



            }
            else if (feature && feature.get('salonid')) {//if the feature clicked is a salon
                var salon = {
                    id: feature.get('salonid')
                }
                var info = feature.get('salonid');
                showPopup(feature, "salon");

            } else if (feature && feature.get('tipo') == "uparrow") {
                hidePopup();
                for (var i = rooms.length - 1; i >= 0; i--) {
                    if (rooms[i].get('piso') == selectedFloor && rooms[i].get('edificioid') == feature.get('edificio').get('id')) {
                        console.log("removed room: ", rooms[i].get('nombre'));
                        rooms.splice(i, 1); // Removing index i

                    }
                }
                map.removeLayer(roomLayer);
                if (selectedFloor >= 1 && selectedFloor <= feature.get('edificio').get('pisos') - 1) {
                    selectedFloor++;
                }

                console.log("floor select: ", selectedFloor);

                addRoomsInPolygon(feature.get('edificio'), feature.get('edificio').get('salones'), selectedFloor);
                roomLayer.setVisible(1);
            } else if (feature && feature.get('tipo') == "downarrow") {
                hidePopup();
                for (var i = rooms.length - 1; i >= 0; i--) {
                    if (rooms[i].get('piso') == selectedFloor && rooms[i].get('edificioid') == feature.get('edificio').get('id')) {
                        console.log("removed room: ", rooms[i].get('nombre'));
                        rooms.splice(i, 1); // Removing index i

                    }
                }
                map.removeLayer(roomLayer);
                if (selectedFloor > 1) {
                    selectedFloor--;
                }

                console.log("floor select: ", selectedFloor);

                addRoomsInPolygon(feature.get('edificio'), feature.get('edificio').get('salones'), selectedFloor);
                roomLayer.setVisible(1);
            }
            else {

                hidePopup();
                if (currentHiddenFeature) {
                    showFeature(currentHiddenFeature);
                    currentHiddenFeature = null;
                }
                map.removeLayer(edificioVerticeLayer);
            };
        });

        function getAllFeaturesToArray() {
            var featuresSource = vectorSource.getFeatures();
            var features = [];
            featuresSource.forEach(function (sourceFeature) {
                features.push(sourceFeature);
            });
            return features;
        };

        function hideAllFeatures() {
            var featuresSource = vectorSource.getFeatures();
            featuresSource.forEach(function (sourceFeature) {
                hideFeature(sourceFeature);
            });
        }

        function showAllFeatures() {
            var featuresSource = vectorSource.getFeatures();
            featuresSource.forEach(function (sourceFeature) {
                showFeature(sourceFeature);
            });
        }

        function zoomToRoom(room, zoomLevel, animDurationMs) {
            var ext = room.getGeometry().getExtent();
            console.log("requested zoom for room: ", room.get('nombre'));
            var center = ol.extent.getCenter(ext);
            var view = map.getView();
            view.animate({
                projection: 'EPSG:3857',
                center: [center[0], center[1]],//zoom to the center of feature
                zoom: zoomLevel,
                duration: animDurationMs,
                extent: bounds
            });



            roomLayer.setVisible(1); //force rooms to show on zoom
            vectorLayer.setVisible(0);
        }

        function getEdificioFeaturefromID(salonid) {
            var edificioFound = undefined;
            edificios.forEach(function (edificio) {
                var salonList = edificio.get('salones');
                salonList.forEach(function (salon) {
                    if (salonid == salon.salonid) {
                        console.log("se encontro el salon en json: ", salon.salonid);
                        edificioFound = edificio;
                    }
                })
            });
            return edificioFound;
        }

    </script>
    <style>
        .ol-popup {
            position: absolute;
            background-color: white;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            top: 10px;
            max-width: 250px;
            /* Limit maximum width */
        }

        .ol-popup-closer {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
        }

        #popup-content {
            max-height: 250px;
            /* Limit maximum height if necessary */
            text-align: center;
        }
    </style>

    <div id="popup" class="ol-popup">
        <script>
            var popup = new ol.Overlay({
                element: document.getElementById('popup'),
                autoPan: true,
                autoPanAnimation: {
                    duration: 250
                }
            });
            map.addOverlay(popup);
            function showPopup(feature, tipo) {
                var content = document.getElementById('popup-content');

                var button = document.getElementById('view-details-btn');
                document.getElementById('edificio-nombre').textContent = feature.get('nombre');
                if(feature.get('descripcion')!= null){//show descripcion if it has one
                    document.getElementById('edificio-descripcion').textContent = feature.get('descripcion');
                }
                switch (tipo) {
                    case "salon":
                        button.textContent = "Ver mÃ¡s"
                        break;
                    default:
                        button.textContent = "Ampliar"
                        break;
                }

                document.getElementById('view-details-btn').onclick = function () {
                    alert('View Details clicked for ' + feature.get('nombre'));
                    hidePopup();
                    map.removeLayer(edificioVerticeLayer);

                    if (typeof Android !== 'undefined' && Android.navToSalonInfo && feature.get('salonid')) {
                        Android.navToSalonInfo(feature.get('salonid'));
                    }
                    var ext = feature.getGeometry().getExtent();
                    var center = ol.extent.getCenter(ext);
                    var view = map.getView();
                    view.animate({
                        projection: 'EPSG:3857',//or any projection you are using
                        center: [center[0], center[1]],//zoom to the center of your feature
                        zoom: 19.5,
                        duration: 1000,
                        extent: bounds
                    });
                    if (feature.get('salonid')) {
                        highlightSalon(feature);
                    }


                    roomLayer.setVisible(1); //force rooms to show on zoom
                    vectorLayer.setVisible(0);


                    //force hide edificio icon
                    map.getView().on('change:resolution', function () {
                        var zoom = map.getView().getZoom();
                        roomLayer.setVisible(zoom >= roomTriggerZoom);
                        if (zoom < roomTriggerZoom) {
                            vectorLayer.setVisible(1);
                            arrowLayer.setVisible(0);
                        } else {
                            vectorLayer.setVisible(0);
                            arrowLayer.setVisible(1);
                        }

                    });

                    if (currentHiddenFeature) {
                        showFeature(currentHiddenFeature);
                        currentHiddenFeature = null;
                    }
                };
                switch (tipo) {
                    case "salon":
                        var ext = feature.getGeometry().getExtent();
                        var center = ol.extent.getCenter(ext);
                        popup.setPosition(center);
                        break;

                    default:
                        var featCoords = feature.get('geometry').getCoordinates();
                        popup.setPosition(featCoords);
                        break;
                }

                content.style.display = 'block';
                console.log("popup coords:", featCoords);

            }

            function hidePopup() {
                document.getElementById('popup-content').style.display = 'none';
                popup.setPosition(undefined);
            }


        </script>

        <a href="#" id="popup-closer" class="ol-popup-closer"></a>
        <div id="popup-content">
            <p><strong id="edificio-nombre"></strong></p>
            <p id="edificio-descripcion"></p>
            <button id="view-details-btn">Ver mÃ¡s</button>
        </div>
    </div>
</body>

</html>